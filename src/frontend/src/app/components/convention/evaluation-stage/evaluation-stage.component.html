<mat-accordion>
  <mat-expansion-panel [expanded]="!edit">
    <mat-expansion-panel-header>
      <mat-panel-title>Évaluation du stage</mat-panel-title>
    </mat-expansion-panel-header>
    <div class="mt-3">
      <div class="text-title">Évaluation par l'étudiant</div>
      <mat-divider class="mb-2"></mat-divider>

      <div class="mt-3 mb-2 danger-color" *ngIf="!ficheEvaluation || !ficheEvaluation.validationEtudiant">
        <i class="fa fa-times"></i>&nbsp;Cette évaluation n'a pas encore été validée par le centre de gestion.
      </div>

      <div class="mt-3 mb-2 danger-color" *ngIf="ficheEvaluation && ficheEvaluation.validationEtudiant && !reponseEvaluation">
        <i class="fa fa-times"></i>&nbsp;Cette évaluation n'est pas encore renseignée.
      </div>

      <button class="mt-2" mat-button mat-stroked-button color="primary" (click)="editFicheEtudiant()" [disabled]="!ficheEvaluation ||!ficheEvaluation.validationEtudiant">Éditer la fiche</button>

      <mat-divider class="mt-2 mb-2"></mat-divider>
      <div class="mt-3 mb-2 danger">Cliquez sur le bouton ci-dessous afin d'envoyer un mail prévenant l'étudiant ({{convention.etudiant.mail}}) qu'il peut remplir sa fiche.</div>
      <button class="mb-2" mat-button mat-stroked-button color="primary" (click)="editFicheEtudiant()"><i style="vertical-align: initial;" class="fa fa-envelope"></i>&nbsp;Envoyer</button>

      <mat-divider class="mt-2 mb-2"></mat-divider>

      <div class="text-title">Évaluation par l'enseignant référent</div>
      <mat-divider class="mb-2"></mat-divider>

      <mat-divider class="mt-2 mb-2"></mat-divider>
      <div class="text-title">Appréciation du tuteur professionnel</div>
      <mat-divider class="mb-2"></mat-divider>
    </div>

  </mat-expansion-panel>

  <mat-expansion-panel [expanded]="editEtu" [disabled]="!ficheEvaluation ||!ficheEvaluation.validationEtudiant">
    <mat-expansion-panel-header>
      <mat-panel-title>Évaluation par l'étudiant</mat-panel-title>
      <mat-panel-description>
        <div class="w-100 text-right">
          <mat-icon fontSet="fa" fontIcon="fa-user"></mat-icon>
        </div>
      </mat-panel-description>
    </mat-expansion-panel-header>

    <mat-accordion *ngIf="ficheEvaluation && ficheEvaluation.validationEtudiant">
      <form [formGroup]="reponseEtudiantForm" novalidate (submit)="saveReponseEtudiant()">

        <mat-expansion-panel [expanded]="false">
          <mat-expansion-panel-header>
            <mat-panel-title>Avant le départ en stage</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="mt-2 mb-2" *ngFor="let question of FicheEtudiantIQuestions">
            <div *ngIf="ficheEvaluation['question' + question.controlName]">
              <div class="row mb-2" *ngIf="question.type == 'boolean'">
                <div class="col-md-12">
                  <div class="mb-2"><b>{{question.title}}</b></div>
                  <mat-radio-group formControlName="{{'reponse' + question.controlName}}">
                    <mat-radio-button [value]="true">Oui</mat-radio-button>
                    <mat-radio-button [value]="false">Non</mat-radio-button>
                  </mat-radio-group>
                </div>
              </div>
              <div class="row mb-2" *ngIf="question.type == 'multiple-choice'">
                <div class="col-md-12">
                  <div class="mb-2"><b>{{question.title}}</b></div>
                  <mat-radio-group style="display: grid" formControlName="{{'reponse' + question.controlName}}">
                    <mat-radio-button style="margin-left: 0px" *ngFor="let line of question.texte; let ind = index" [value]="ind">{{line}}</mat-radio-button>
                  </mat-radio-group>
                </div>
              </div>
              <div class="row mb-2" *ngIf="question.type == 'multiple-boolean'">
                <div class="col-md-12">
                  <div class="mb-2"><b>{{question.title}}</b></div>
                  <div class="row" *ngFor="let line of question.texte; let ind = index">
                    <div class="col-sm-3">
                      {{line}}
                    </div>
                    <div class="col-sm-9">
                      <mat-radio-group formControlName="{{'reponse' + question.controlName + controlsIndexToLetter[ind]}}">
                        <mat-radio-button [value]="true">Oui</mat-radio-button>
                        <mat-radio-button [value]="false">Non</mat-radio-button>
                      </mat-radio-group>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-2" *ngIf="question.type == 'EtuI5'">
                <div class="col-md-12">
                  <div class="mb-2"><b>{{question.title}}</b></div>
                  <div class="mb-2">{{convention.origineStage.libelle}}</div>
                </div>
              </div>
              <div class="row mb-2" *ngIf="question.type == 'EtuI7'">
                <div class="col-md-12">
                  <div class="mb-2"><b>{{question.title}}</b></div>
                  <mat-radio-group formControlName="reponseEtuI7">
                    <mat-radio-button [value]="true">Oui</mat-radio-button>
                    <mat-radio-button [value]="false">Non</mat-radio-button>
                  </mat-radio-group>
                  <div class="row mb-2" *ngIf="reponseEtudiantForm.get('reponseEtuI7')?.value === true">
                    <div class="col-12 mb-2">Si oui, par qui ?</div>
                    <mat-radio-group style="display: grid" formControlName="reponseEtuI7bis1">
                      <mat-radio-button style="margin-left: 16px" *ngFor="let line of question.texte | slice:0:5; let ind = index" [value]="ind">{{line}}</mat-radio-button>
                    </mat-radio-group>
                  </div>
                  <div class="row mb-2" *ngIf="reponseEtudiantForm.get('reponseEtuI7')?.value === false">
                    <div class="col-12 mb-2">Si non, pourquoi ?</div>
                    <mat-radio-group style="display: grid" formControlName="reponseEtuI7bis2">
                      <mat-radio-button style="margin-left: 16px" *ngFor="let line of question.texte | slice:5:7; let ind = index" [value]="ind">{{line}}</mat-radio-button>
                    </mat-radio-group>
                  </div>
                </div>
              </div>
              <mat-divider class="mt-2 mb-2"></mat-divider>
            </div>
          </div>
          <div *ngIf="questionsSupplementaires">
            <form [formGroup]="reponseSupplementaireEtudiantForm" novalidate (submit)="saveReponseEtudiant()">
              <div class="mt-2 mb-2" *ngFor="let questionSupplementaire of questionsSupplementaires[0]">
                <div class="mb-2"><b>{{questionSupplementaire.question}}</b></div>
                <mat-form-field style="width: 100%" *ngIf="questionSupplementaire.typeQuestion == 'txt'" appearance="fill">
                  <textarea matInput formControlName="{{questionSupplementaire.formControlName}}"></textarea>
                  <mat-error><app-form-error [field]="reponseSupplementaireEtudiantForm.get(questionSupplementaire.formControlName)"></app-form-error></mat-error>
                </mat-form-field>
                <mat-radio-group *ngIf="questionSupplementaire.typeQuestion == 'not'" style="display: grid" formControlName="{{questionSupplementaire.formControlName}}">
                  <mat-radio-button style="margin-left: 0px" [value]="0">Excellent</mat-radio-button>
                  <mat-radio-button style="margin-left: 0px" [value]="1">Très bien</mat-radio-button>
                  <mat-radio-button style="margin-left: 0px" [value]="2">Bien</mat-radio-button>
                  <mat-radio-button style="margin-left: 0px" [value]="3">Satisfaisant</mat-radio-button>
                  <mat-radio-button style="margin-left: 0px" [value]="4">Insuffisant</mat-radio-button>
                </mat-radio-group>
                <mat-radio-group *ngIf="questionSupplementaire.typeQuestion == 'yn'" formControlName="{{questionSupplementaire.formControlName}}">
                  <mat-radio-button [value]="true">Oui</mat-radio-button>
                  <mat-radio-button [value]="false">Non</mat-radio-button>
                </mat-radio-group>
                <mat-divider class="mt-2 mb-2"></mat-divider>
              </div>
            </form>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel [expanded]="false">
          <mat-expansion-panel-header>
            <mat-panel-title>Pendant le stage</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="mt-3 mb-3">
            <div class="row">
              <div class="col-sm-3">Questions</div>
              <div class="col-sm-9">Activation</div>
            </div>
            <mat-divider class="mt-2 mb-2"></mat-divider>
          </div>
          <div class="mt-2 mb-2" *ngFor="let question of FicheEtudiantIIQuestions">
            <div class="row mb-2" *ngIf="question.type == 'boolean'">
              <div class="col-md-12">
                <div class="mb-2">{{question.title}}</div>
                <mat-radio-group formControlName="{{'reponse' + question.controlName}}">
                  <mat-radio-button [value]="true">Oui</mat-radio-button>
                  <mat-radio-button [value]="false">Non</mat-radio-button>
                </mat-radio-group>
              </div>
            </div>
            <mat-divider class="mt-2 mb-2"></mat-divider>
          </div>
          <div *ngIf="questionsSupplementaires">
            <form [formGroup]="reponseSupplementaireEtudiantForm" novalidate (submit)="saveReponseEtudiant()">
              <div class="mt-2 mb-2" *ngFor="let questionSupplementaire of questionsSupplementaires[0]">
                <div class="mb-2"><b>{{questionSupplementaire.question}}</b></div>
                <textarea matInput formControlName="{{questionSupplementaire.formControlName}}"></textarea>
              </div>
            </form>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel [expanded]="false">
          <mat-expansion-panel-header>
            <mat-panel-title>Après le stage</mat-panel-title>
          </mat-expansion-panel-header>
          <div class="mt-3 mb-3">
            <div class="row">
              <div class="col-sm-3">Questions</div>
              <div class="col-sm-9">Activation</div>
            </div>
            <mat-divider class="mt-2 mb-2"></mat-divider>
          </div>
          <div class="mt-2 mb-2" *ngFor="let question of FicheEtudiantIIIQuestions">
            <div class="row mb-2" *ngIf="question.type == 'boolean'">
              <div class="col-md-12">
                <div class="mb-2">{{question.title}}</div>
                <mat-radio-group formControlName="{{'reponse' + question.controlName}}">
                  <mat-radio-button [value]="true">Oui</mat-radio-button>
                  <mat-radio-button [value]="false">Non</mat-radio-button>
                </mat-radio-group>
              </div>
            </div>
            <mat-divider class="mt-2 mb-2"></mat-divider>
          </div>
        </mat-expansion-panel>

        <div class="row mt-3">
          <div class="col-sm-6">
            <button type="button" mat-button mat-stroked-button color="warn" (click)="cancelEdit()">{{'BOUTON_ANNULER'|contenu}}</button>
          </div>
          <div class="col-sm-6 text-right">
            <button mat-button mat-flat-button color="primary">{{'BOUTON_VALIDER'|contenu}}</button>
          </div>
        </div>
      </form>
    </mat-accordion>

  </mat-expansion-panel>
</mat-accordion>
